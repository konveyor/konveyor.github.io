<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.120.4"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Transformers - Documentation for Konveyor projects</title>
<link href=/css/nucleus.css rel=stylesheet><link href=/css/fontawesome-all.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/perfect-scrollbar.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/css/atom-one-dark-reasonable.css rel=stylesheet><link href=/css/theme.css rel=stylesheet><link href=/css/tabs.css rel=stylesheet><link href=/css/hugo-theme.css rel=stylesheet><link href=/css/theme-konveyor.css rel=stylesheet><link href=/css/foo.css rel=stylesheet><link href=/css/bar.css rel=stylesheet><script src=/js/jquery-3.3.1.min.js></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script>var dataLayer=window.dataLayer=window.dataLayer||[];dataLayer.push({page:"Transformers",fileUniqID:"d3a485d6aa53c2ec84071b7bf6bc96a0"})</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-TKPDMS3")</script></head><body data-url=/move2kube/transformers/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><img src=/images/konveyor_logo.png></img></a>
<a href=https://github.com/konveyor/konveyor.github.io>Documentation source code</a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js></script><script type=text/javascript src=/js/auto-complete.js></script><script type=text/javascript>var baseurl="http://konveyor.github.io/"</script><script type=text/javascript src=/js/search.js></script></div><div class=highlightable><ul class=topics><li data-nav-id=/konveyor/ title=Konveyor class=dd-item><a href=/konveyor/>Konveyor</a><ul><li data-nav-id=/konveyor/contributetokonveyor/ title="Contributing To Konveyor" class=dd-item><a href=/konveyor/contributetokonveyor/>Contributing To Konveyor</a></li><li data-nav-id=/konveyor/admintasks/ title="Administrator view tasks" class=dd-item><a href=/konveyor/admintasks/>Administrator view tasks</a></li><li data-nav-id=/konveyor/views/ title=Views class=dd-item><a href=/konveyor/views/>Views</a></li><li data-nav-id=/konveyor/instances/ title="Seeding Instances" class=dd-item><a href=/konveyor/instances/>Seeding Instances</a></li><li data-nav-id=/konveyor/installation/ title="Installing Konveyor" class=dd-item><a href=/konveyor/installation/>Installing Konveyor</a></li><li data-nav-id=/konveyor/assessanalyze/ title="Assessing and analyzing applications" class=dd-item><a href=/konveyor/assessanalyze/>Assessing and analyzing applications</a></li><li data-nav-id=/konveyor/addapps/ title="Adding applications" class=dd-item><a href=/konveyor/addapps/>Adding applications</a></li></ul></li><li data-nav-id=/move2kube/ title=Move2Kube class="dd-item
parent"><a href=/move2kube/>Move2Kube</a><ul><li data-nav-id=/move2kube/concepts/ title=Concepts class=dd-item><a href=/move2kube/concepts/>Concepts</a></li><li data-nav-id=/move2kube/installation/ title=Installation class=dd-item><a href=/move2kube/installation/>Installation</a><ul><li data-nav-id=/move2kube/installation/installweb/ title="Web Interface" class=dd-item><a href=/move2kube/installation/installweb/>Web Interface</a></li><li data-nav-id=/move2kube/installation/installcli/ title="Command line tool" class=dd-item><a href=/move2kube/installation/installcli/>Command line tool</a></li></ul></li><li data-nav-id=/move2kube/commands/ title=Commands class=dd-item><a href=/move2kube/commands/>Commands</a></li><li data-nav-id=/move2kube/transformers/ title=Transformers class="dd-item active"><a href=/move2kube/transformers/>Transformers</a></li><li data-nav-id=/move2kube/tutorials/ title=Tutorials class=dd-item><a href=/move2kube/tutorials/>Tutorials</a><ul><li data-nav-id=/move2kube/tutorials/usingcli/ title="Using Move2Kube CLI" class=dd-item><a href=/move2kube/tutorials/usingcli/>Using Move2Kube CLI</a></li><li data-nav-id=/move2kube/tutorials/usingui/ title="Using Move2Kube UI" class=dd-item><a href=/move2kube/tutorials/usingui/>Using Move2Kube UI</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/ title="Migrating Enterprise Scale Cloud Foundry Apps to Kubernetes" class=dd-item><a href=/move2kube/tutorials/cfappstok8/>Migrating Enterprise Scale Cloud Foundry Apps to Kubernetes</a><ul><li data-nav-id=/move2kube/tutorials/cfappstok8/1collect/ title="1. Collect" class=dd-item><a href=/move2kube/tutorials/cfappstok8/1collect/>1. Collect</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/2plan/ title="2. Plan" class=dd-item><a href=/move2kube/tutorials/cfappstok8/2plan/>2. Plan</a></li><li data-nav-id=/move2kube/tutorials/cfappstok8/3transform/ title="3. Transform" class=dd-item><a href=/move2kube/tutorials/cfappstok8/3transform/>3. Transform</a></li></ul></li><li data-nav-id=/move2kube/tutorials/customizeoutput/ title="Customizing the output" class=dd-item><a href=/move2kube/tutorials/customizeoutput/>Customizing the output</a><ul><li data-nav-id=/move2kube/tutorials/customizeoutput/addcustfiledir/ title="Add custom files and directories in custom locations" class=dd-item><a href=/move2kube/tutorials/customizeoutput/addcustfiledir/>Add custom files and directories in custom locations</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/paramcustomfieldshelm/ title="Parameterizing custom fields in Helm Chart, Kustomize, OC templates" class=dd-item><a href=/move2kube/tutorials/customizeoutput/paramcustomfieldshelm/>Parameterizing custom fields in Helm Chart, Kustomize, OC templates</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/customannotationsyaml/ title="Add custom annotations to Kubernetes YAMLs" class=dd-item><a href=/move2kube/tutorials/customizeoutput/customannotationsyaml/>Add custom annotations to Kubernetes YAMLs</a></li><li data-nav-id=/move2kube/tutorials/customizeoutput/customgendockerfile/ title="Customize generated Dockerfile and built-in transformer behavior" class=dd-item><a href=/move2kube/tutorials/customizeoutput/customgendockerfile/>Customize generated Dockerfile and built-in transformer behavior</a></li></ul></li><li data-nav-id=/move2kube/tutorials/customkubeyaml/ title="Customize Kubernetes YAMLs to target specific clusters" class=dd-item><a href=/move2kube/tutorials/customkubeyaml/>Customize Kubernetes YAMLs to target specific clusters</a></li><li data-nav-id=/move2kube/tutorials/createhelmchartskustomize/ title="Create Helm-charts, Kustomize overlays from Kubernetes Yamls" class=dd-item><a href=/move2kube/tutorials/createhelmchartskustomize/>Create Helm-charts, Kustomize overlays from Kubernetes Yamls</a></li><li data-nav-id=/move2kube/tutorials/createwincontainersnet/ title="Create and deploy Windows .NET containers" class=dd-item><a href=/move2kube/tutorials/createwincontainersnet/>Create and deploy Windows .NET containers</a></li><li data-nav-id=/move2kube/tutorials/migratedeploynetcore/ title="Migrate and deploy .NET Core applications to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedeploynetcore/>Migrate and deploy .NET Core applications to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/migratedockercomposekube/ title="Migrate from Docker Compose to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedockercomposekube/>Migrate from Docker Compose to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/migratedeploycfapps/ title="Migrate and deploy Cloud Foundry applications to Kubernetes" class=dd-item><a href=/move2kube/tutorials/migratedeploycfapps/>Migrate and deploy Cloud Foundry applications to Kubernetes</a></li><li data-nav-id=/move2kube/tutorials/runnoninteractively/ title="Run transforms non-interactively" class=dd-item><a href=/move2kube/tutorials/runnoninteractively/>Run transforms non-interactively</a></li></ul></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Transformers</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#purpose-built>Purpose Built</a><ul><li><a href=#parameterizer>Parameterizer</a></li></ul></li><li><a href=#external>External</a><ul><li><a href=#executable>Executable</a></li><li><a href=#starlark>Starlark</a></li></ul></li><li><a href=#special>Special</a><ul><li><a href=#router>Router</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Transformers</h1><p>Move2Kube uses a suite of transformers to modify objects. To customize the output artifacts generated for a specific input, these transformers can be configured or new custom transformers can be created to achieve the required result. Transformer behavior and configuration is determined by the Transformer Class it uses. Though all the transformer classes are equal internally in Move2Kube, from a usage perspective, they are classified into three categories.</p><ul><li>Purpose Built - Has a specific job and the customization allows for changing the parameters/configuration required for performing the specific job. Ex: <code>Kubernetes</code>, <code>Parameterizer</code>, <code>GolangDockerfileGenerator</code>, etc..</li><li>External - Allows you to write custom transformers performing any behavior. It exposes the internal functions of the transformer class through different interfaces to be implemented by the transformer externally. Ex: <code>Starlark</code>, <code>Executable</code></li><li>Special - These classes allow special behaviors. Ex: <code>Router</code></li></ul><h2 id=purpose-built>Purpose Built</h2><p>These transformer classes do a specific job, and the customization allows for changing the parameters/configuration required for performing the specific job.</p><p>In most cases, these classes have one internal implementation and a transformer configuration can be found <a href=https://github.com/konveyor/move2kube/tree/main/assets/built-in/transformers>here</a>.</p><p>The general steps to use these transformer classes are:</p><ol><li>Find the internal implementation <a href=https://github.com/konveyor/move2kube/tree/main/assets/built-in/transformers>here</a>.</li><li>Copy the directory.</li><li>Change the configuration like the transformer name, templates, etc..</li><li>Set it to override the internal implementation.</li></ol><p>The custom transformer tutorial that uses node.js/Kubernetes transformers and the parameterization tutorial that uses the parameterization transformer are examples.</p><p>To understand the configuration provided by each of these transformers, the YAML in the built-in transformer should have a good overview. The other location to look for is the structure in the transformer implementation. In most classes which have a configuration, there will be a structure with a name ending in <code>YamlConfig</code>. For example, the Kubernetes transformer class has <a href=https://github.com/konveyor/move2kube/blob/171f6d26c195ce1e1f8b0ec6e7b68d17401776f3/transformer/kubernetes/kubernetestransformer.go#L48>KubernetesYamlConfig</a>. This is the configuation specified in the <code>spec.config</code> field.</p><h3 id=parameterizer>Parameterizer</h3><p>Find the <a href=https://github.com/konveyor/move2kube/blob/39ef793031c2990a0c1f588d85c4237655a49653/transformer/kubernetes/parameterizer/types.go#L43-L91>source code</a> here, and follow this tutorial to customize paramaterization.</p><h4 id=syntax-for-parameterizing-specific-fields>Syntax for parameterizing specific fields</h4><p>Move2Kube provides a way to parameterize any field in the Kubernetes YAML files, Helm charts, and Openshift Templates that Move2Kube generates. It can also parameterize fields in Kubernetes YAMLs found in the source directory.</p><p>In order to parameterize a specific field, Move2Kube needs to use a custom transformer which means a directory with some YAML files inside it needs to be created. Below is an <a href=https://github.com/konveyor/move2kube-transformers/blob/main/custom-helm-kustomize-octemplates-parameterization>example parameterizer</a> in detail:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>README.md deployment-parameterizers.yaml parameterizers.yaml
</span></span></code></pre></div><p>Look at the <a href=https://github.com/konveyor/move2kube-transformers/blob/main/custom-helm-kustomize-octemplates-parameterization/deployment-parameterizers.yaml>deployment-parameterizers.yaml</a> to understand the syntax.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>move2kube.konveyor.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Parameterizer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deployment-parameterizers</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>parameterizers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>target</span>: <span style=color:#e6db74>&#34;spec.replicas&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>template</span>: <span style=color:#e6db74>&#34;${common.replicas}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;.*/v1.*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Now the `values.yaml` looks like this</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>target</span>: <span style=color:#e6db74>&#39;spec.template.spec.containers.[containerName:name].image&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>template</span>: <span style=color:#e6db74>&#39;${imageregistry.url}/${imageregistry.namespace}/${services.$(metadataName).containers.$(containerName).image.name}:${services.$(metadataName).containers.$(containerName).image.tag}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>default</span>: <span style=color:#ae81ff>quay.io/konveyor/myimage:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>apiVersion</span>: <span style=color:#e6db74>&#34;.*/v1.*&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>services.$(metadataName).containers.$(containerName).image.name</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>values</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>envs</span>: [<span style=color:#ae81ff>dev, staging, prod]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>metadataName</span>: <span style=color:#ae81ff>frontend</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>value</span>: <span style=color:#ae81ff>frontend</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>envs</span>: [<span style=color:#ae81ff>prod]</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>metadataName</span>: <span style=color:#ae81ff>orders</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>value</span>: <span style=color:#ae81ff>orders</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>containerName</span>: <span style=color:#ae81ff>orders</span>
</span></span></code></pre></div><p>Notice the parameterizer YAML follows the same conventions as Kubernetes YAMLs.</p><ul><li><code>apiVersion</code> : <code>string</code> - The version of the Move2Kube API being used which is currently set at <code>move2kube.konveyor.io/v1alpha1</code>.</li><li><code>kind</code> : <code>string</code> - Tells Move2Kube the YAML file type which in this case it is set at <code>Parameterizer</code>.</li><li><code>metadata</code> : <code>object</code><ul><li><code>name</code> : <code>string</code> - Name of the parameterizer.</li></ul></li><li><code>spec</code> : <code>object</code><ul><li><code>parameterizers</code> : <code>array[object]</code> - List of parameterizer objects.<ul><li><p><code>target</code> : <code>string</code> - Sets the field to parameterize. The syntax is the same as <code>yq</code> dot notation which is explained in more detail in a later section.</p></li><li><p><code>template</code> : <code>string</code> - Specifies how the field should get its value. For example: <code>"${common.replicas}"</code> means the generated Helm chart which contains the <code>values.yaml</code> there is the <code>common</code> field, and inside it <code>replicas</code> as shown below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ cat values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p>The value of this field will be the same as the value in the original YAML, but it can be overriden using the <code>default</code> parameter.</p></li><li><p><code>default</code> : <code>any</code> Can be used to override the default value for the field being parameterized. For example: if the original value of <code>spec.replicas</code> was <code>2</code>, then the <code>values.yaml</code> would look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ cat values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>To set a different value like <code>10</code>, specify <code>default: 10</code> in the parameterizer YAML and now the <code>values.yaml</code> looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ cat values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>10</span>
</span></span></code></pre></div></li><li><p><code>filters</code> : <code>array[object]</code> - Used to filter the Kubernetes YAML files that being targeted.</p><ul><li><code>kind</code> : <code>string</code> - Only parameterizes Kubernetes YAMLs that match this <code>kind</code> field. Specify a regex to match multiple kinds.
<code>apiVersion</code> : <code>string</code> - Only parameterizers Kubernetes YAMLs that match this <code>apiVersion</code> field. A regex can be specified.
<code>name</code> : <code>string</code> - Only parameterizes Kubernetes YAMLs that have the same <code>metadata.name</code> field. A regex can be specified.
<code>envs</code> : <code>array[string]</code> - Only apply this parameterization when targeting one of the environments listed here.</li></ul></li><li><p><code>parameters</code> : <code>array[object]</code> - Can be used to specify defaults for each parameter inside the <code>template</code>.</p><ul><li><code>name</code> : <code>string</code> - Name of a parameter inside the <code>template</code>.</li><li><code>default</code> : <code>string</code> - Default value for this parameter.</li></ul></li></ul></li></ul></li></ul><h4 id=template-parameter>Template parameter</h4><p>When parameterizing a specific a field in a Kubernetes YAML, it can be templatized in different ways. If the <code>template</code> parameter is not specified, it will default to the <code>target</code> parameter.</p><h5 id=example-1>Example 1</h5><p>For example: <code>target: "spec.replicas"</code> would cause the <code>spec.replicas</code> to be parameterized (probably in Deployment YAMLs).
Move2Kube would parameterize it under the key <code>&lt;kind>.&lt;apiVersion>.&lt;metadata.name>.spec.replicas</code> and the <code>values.yaml</code> would look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Deployment</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>v1</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>myDeploymentName</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>In this example <code>myDeploymentName</code> is the <code>metadata.name</code> field in the Deployment YAML and <code>2</code> is the original value for <code>spec.replicas</code> from the YAML file.</p><p>By specifying <code>template: "${common.replicas}"</code> the default key is overridden and now Move2Kube puts the following in the <code>values.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>2</span>
</span></span></code></pre></div><p>By specifying <code>default: 10</code> the default value is overridden and now Move2Kube puts the following in the <code>values.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>common</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h5 id=example-2>Example 2</h5><p>This example is a more complicated scenario of parameterizing the image name of some container in a Deployment YAML. First, because the <code>containers</code> field in the Deployment YAML is a list, use the syntax <code>[&lt;index>]</code> to parameterize a single element in the list.</p><p>Use <code>target: "spec.template.spec.containers.[0].image"</code> to parameterize the first container in the Deployment.
The <code>values.yaml</code> looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>Deployment</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>v1</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>myDeploymentName</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>                    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>                        <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>                            - <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#39;my-repo.com/my-namespace/my-image-name:my-image-tag&#39;</span>
</span></span></code></pre></div><p>This may not be enough and may need to parameterize the container image registry URL, registry namespace, image name, and image tag separately.</p><p>To do this use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>template</span>: <span style=color:#e6db74>&#39;${imageregistry.url}/${imageregistry.namespace}/${containers.[0].image.name}:${containers.[0].image.tag}&#39;</span>
</span></span></code></pre></div><p>This will cause the <code>values.yaml</code> to look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imageregistry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#39;my-repo.com&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#39;my-namespace&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;my-image-name&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#39;my-image-tag&#39;</span>
</span></span></code></pre></div><p>The Helm template will look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#ae81ff>% raw %}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>                - <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#39;{{ index .Values &#34;imageregistry&#34; &#34;url&#34; }}/{{ index .Values &#34;imageregistry&#34; &#34;namespace&#34; }}/{{ index .Values &#34;containers&#34; &#34;[0]&#34; &#34;image&#34; &#34;name&#34; }}:{{ index .Values &#34;containers&#34; &#34;[0]&#34; &#34;image&#34; &#34;tag&#34; }}&#39;</span>
</span></span><span style=display:flex><span>{<span style=color:#ae81ff>% endraw %}</span>
</span></span></code></pre></div><h5 id=example-3>Example 3</h5><p>This is an even more complicated scenario continuing from Example 2 that adds a dynamic key in the <code>values.yaml</code>.</p><p>To do this use the <code>[]</code> square brackets and <code>$</code> dollar sign syntax:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>target</span>: <span style=color:#e6db74>&#39;spec.template.spec.containers.[containerName:name].image&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>template</span>: <span style=color:#e6db74>&#39;${imageregistry.url}/${imageregistry.namespace}/${containers.$(containerName).image.name}:${containers.$(containerName).image.tag}&#39;</span>
</span></span></code></pre></div><p>Here <code>[containerName:name]</code> in <code>target</code> tells Move2Kube to extract the <code>name</code> field from the <code>container</code> object in the Deployment YAML and make it available as <code>containerName</code>.
The <code>$(containerName)</code> in <code>template</code> gets replaced by the <code>name</code> that was extracted.</p><p>The <code>values.yaml</code> looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>imageregistry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#39;my-repo.com&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#39;my-namespace&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>myContainerName1</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;my-image-name&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#39;my-image-tag&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>myContainerName2</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;my-image-name-2&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>tag</span>: <span style=color:#e6db74>&#39;my-image-tag-2&#39;</span>
</span></span></code></pre></div><p>This provides a very powerful way to parameterize the image name of containers and simultaneously have a common registry URL and namespace for all the images while also parameterizing the image name and tag for each container separately.</p><hr><h2 id=external>External</h2><p>These transformer classes allow you to write custom transformers performing any behavior. It exposes the internal functions of the transformer class through different interfaces to be implemented by the transformer externally.</p><h3 id=executable>Executable</h3><p>An <code>Executable</code> class based on a transformer can be configured to run commands locally or as containers. These transformers essentially implement the <code>DirectoryDetect</code> and <code>Transform</code> functions of the transformer as executable commands. This allows using any language to write the function and makes them very powerful.</p><h3 id=starlark>Starlark</h3><p>A <code>Starlark</code> class based transformer allows for writing a full fledged transformer in <a href=https://docs.bazel.build/versions/2.1.0/skylark/language.html>Starlark</a> by implementing the <code>directory_detect</code> and <code>transform</code> functions.</p><p>See examples of using this transform class:</p><ul><li><a href=https://github.com/konveyor/move2kube-transformers/tree/main/add-custom-kubernetes-annotation>add-custom-kubernetes-annotation</a></li><li><a href=https://github.com/konveyor/move2kube-transformers/tree/main/add-custom-files-directories-in-custom-locations>add-custom-files-directories-in-custom-locations</a>.</li></ul><h2 id=special>Special</h2><p>These classes allow special behaviors.</p><h3 id=router>Router</h3><p>The Router transformer directs an artifact to one of the eligible transformers, like choosing the server for a WAR file.</p><p><a href=https://github.com/konveyor/move2kube/tree/main/assets/built-in/transformers/dockerfilegenerator/java/warrouter>WarRouter</a> and <a href=https://github.com/konveyor/move2kube/tree/main/assets/built-in/transformers/dockerfilegenerator/java/earrouter>EarRouter</a> are examples of using this transformer class.</p><p><a href=https://github.com/konveyor/konveyor.github.io/blob/main/content/Move2Kube/transformers.md>Source</a></p><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js></script><script src=/js/perfect-scrollbar.min.js></script><script src=/js/perfect-scrollbar.jquery.min.js></script><script src=/js/jquery.sticky.js></script><script src=/js/featherlight.min.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js></script><script src=/js/learn.js></script><script src=/js/hugo-learn.js></script><script src=https://unpkg.com/mermaid@8.8.0/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKPDMS3" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript></body></html>